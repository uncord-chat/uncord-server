# =============================================================================
# Uncord Server Configuration
# =============================================================================
#
# Several fields below are set to placeholder values that MUST be replaced
# before running in production. Search this file for "REPLACE" to find them.
#
# To generate a cryptographically secure random string, run:
#
#   openssl rand -hex 32
#
# Use a unique value for each field. Do not reuse secrets across fields.


# =============================================================================
# Core
# =============================================================================

# The SERVER_URL and SMTP settings are overwritten when SERVER_ENV=development
# so that the configuration works within Docker.

SERVER_NAME="Uncord Chat"
SERVER_DESCRIPTION="Your community. Your server. Your rules."
SERVER_URL="https://chat.example.com"
SERVER_PORT=8080
SERVER_ENV=production

# Must be exactly 64 hex characters (32 bytes).
SERVER_SECRET="REPLACE"


# =============================================================================
# Database
# =============================================================================

# Ensure the password within DATABASE_URL matches DB_PASSWORD.
DATABASE_URL="postgres://uncord:REPLACE@postgres:5432/uncord?sslmode=disable"
DATABASE_MAX_CONNS=25
DATABASE_MIN_CONNS=5
DB_PASSWORD="REPLACE"


# =============================================================================
# Valkey
# =============================================================================

VALKEY_URL="valkey://valkey:6379/0"
VALKEY_DIAL_TIMEOUT=5s
VALKEY_PASSWORD="REPLACE"


# =============================================================================
# Auth
# =============================================================================

# Must be at least 32 characters.
JWT_SECRET="REPLACE"

JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=168h

ARGON2_MEMORY=65536
ARGON2_ITERATIONS=3
ARGON2_PARALLELISM=2
ARGON2_SALT_LENGTH=16
ARGON2_KEY_LENGTH=32

# How long to retain login attempts before automatic cleanup (Go duration format).
LOGIN_ATTEMPT_RETENTION=2160h


# =============================================================================
# MFA (Multi-Factor Authentication)
# =============================================================================

# Must be exactly 64 hex characters (32 bytes).
MFA_ENCRYPTION_KEY="REPLACE"

MFA_TICKET_TTL=5m


# =============================================================================
# Email (SMTP)
# =============================================================================

SMTP_HOST=""
SMTP_PORT=587
SMTP_USERNAME=""
SMTP_PASSWORD=""
SMTP_FROM="noreply@chat.example.com"


# =============================================================================
# Logging
# =============================================================================

LOG_HEALTH_REQUESTS=true


# =============================================================================
# Storage
# =============================================================================

STORAGE_BACKEND=local
STORAGE_LOCAL_PATH=/data/uncord/media

STORAGE_S3_ENDPOINT=""
STORAGE_S3_ACCESS_KEY=""
STORAGE_S3_SECRET_KEY=""
STORAGE_S3_BUCKET_ATTACHMENTS="uncord-attachments"
STORAGE_S3_BUCKET_AVATARS="uncord-avatars"
STORAGE_S3_BUCKET_EMOJI="uncord-emoji"


# =============================================================================
# Upload Limits
# =============================================================================

MAX_UPLOAD_SIZE_MB=100
MAX_AVATAR_SIZE_MB=8
MAX_AVATAR_DIMENSION=1080
MAX_EMOJI_SIZE_KB=256
MAX_EMOJI_PER_SERVER=200


# =============================================================================
# Typesense
# =============================================================================

TYPESENSE_URL="http://typesense:8108"
TYPESENSE_API_KEY="REPLACE"
TYPESENSE_TIMEOUT=30s


# =============================================================================
# Gateway
# =============================================================================

GATEWAY_HEARTBEAT_INTERVAL_MS=45000
GATEWAY_SESSION_TTL_SECONDS=300
GATEWAY_REPLAY_BUFFER_SIZE=1000
GATEWAY_MAX_CONNECTIONS=10000


# =============================================================================
# Rate Limiting
# =============================================================================

# General API rate limit.
RATE_LIMIT_API_REQUESTS=60
RATE_LIMIT_API_WINDOW_SECONDS=60

# Per-channel message rate limit.
RATE_LIMIT_MSG_COUNT=5
RATE_LIMIT_MSG_WINDOW_SECONDS=5

# Global message rate limit (across all channels).
RATE_LIMIT_MSG_GLOBAL_COUNT=30
RATE_LIMIT_MSG_GLOBAL_WINDOW_SECONDS=60

# File upload rate limit.
RATE_LIMIT_UPLOAD_COUNT=10
RATE_LIMIT_UPLOAD_WINDOW_SECONDS=60

# Authentication endpoint rate limit.
RATE_LIMIT_AUTH_COUNT=5
RATE_LIMIT_AUTH_WINDOW_SECONDS=300

# WebSocket message rate limit.
RATE_LIMIT_WS_COUNT=120
RATE_LIMIT_WS_WINDOW_SECONDS=60

# Plugin API rate limit.
RATE_LIMIT_PLUGIN_COUNT=120
RATE_LIMIT_PLUGIN_WINDOW_SECONDS=60


# =============================================================================
# Server Limits
# =============================================================================

MAX_CHANNELS=500
MAX_CATEGORIES=50
MAX_ROLES=250
MAX_MEMBERS=0
MAX_MESSAGE_LENGTH=4000
MAX_GROUP_DM_PARTICIPANTS=10
MESSAGE_RETENTION_DAYS=0


# =============================================================================
# Onboarding
# =============================================================================

ONBOARDING_REQUIRE_RULES=true
ONBOARDING_REQUIRE_EMAIL_VERIFICATION=true
ONBOARDING_MIN_ACCOUNT_AGE=0
ONBOARDING_REQUIRE_PHONE=false
ONBOARDING_REQUIRE_CAPTCHA=false


# =============================================================================
# Anti-Abuse
# =============================================================================

ABUSE_DISPOSABLE_EMAIL_BLOCKLIST_ENABLED=true
ABUSE_DISPOSABLE_EMAIL_BLOCKLIST_TIMEOUT=10s
ABUSE_EMAIL_DOMAIN_ALLOWLIST=""
ABUSE_EMAIL_DOMAIN_BLOCKLIST=""
ABUSE_AUTO_BAN_SHARED_IP=false
ABUSE_AUTO_BAN_SHARED_DEVICE=false


# =============================================================================
# Plugins
# =============================================================================

PLUGIN_EVENT_STREAM="uncord.events"
PLUGIN_API_PORT=9090


# =============================================================================
# Account Deletion
# =============================================================================

# When true, usernames are "tombstoned" on account deletion to prevent
# re-registration. Existing tombstones are always enforced regardless of this
# setting. Emails are always tombstoned.
DELETION_TOMBSTONE_USERNAMES=true

# How long to retain deletion tombstones. 0 = permanent (default).
# Enabling expiry allows deleted users to eventually re-register with their former email or username.
DELETION_TOMBSTONE_RETENTION=0


# =============================================================================
# Data Retention
# =============================================================================

# How often the background cleanup goroutine runs for all retention policies.
DATA_CLEANUP_INTERVAL=12h


# =============================================================================
# First-Run Owner
# =============================================================================

INIT_OWNER_EMAIL="admin@uncord.chat"
INIT_OWNER_PASSWORD="REPLACE"
